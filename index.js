var D=(x)=>typeof x==="function";var Y=(x,y)=>Object.prototype.toString.call(x)===`[object ${y}]`,_=(x)=>(y)=>y instanceof x,o=_(Error),g=_(Promise),W=(x)=>o(x)?x:Error(String(x));class X extends Error{constructor(x){super(`Circular dependency in ${x} detected`);return this}}var Z,q=new Set,k=0,T=new Map,P,E=()=>{P=void 0;let x=Array.from(T.values());T.clear();for(let y of x)y()},d=()=>{if(P)cancelAnimationFrame(P);P=requestAnimationFrame(E)};queueMicrotask(E);var M=(x)=>{if(Z&&!x.includes(Z))x.push(Z)},I=(x)=>{for(let y of x)if(k)q.add(y);else y()},U=()=>{while(q.size){let x=Array.from(q);q.clear();for(let y of x)y()}},h=(x)=>{k++;try{x()}finally{U(),k--}},R=(x,y)=>{let $=Z;Z=y;try{x()}finally{Z=$}},s=(x,y)=>new Promise(($,B)=>{let F=()=>{try{$(x())}catch(z){B(z)}};if(y)T.set(y,F);d()});var n=(x)=>{let{signals:y,ok:$,err:B}=x,F=x.nil||(()=>{}),z=[],J=[],j=!1;for(let H=0;H<y.length;H++){let N=y[H];try{let Q=N.get();if(Q===G)j=!0;z[H]=Q}catch(Q){J.push(W(Q))}}let V=void 0;try{V=j?F():J.length?B(...J):$(...z)}catch(H){B(W(H))}return V};function C(x){let y=!1,$=()=>R(()=>{if(y)throw new X("effect");y=!0,n(x),y=!1},$);$()}var f="Computed",i=(x,y)=>{if(!y)return!1;return x.name===y.name&&x.message===y.message},A=(x)=>{let y=[],$=G,B,F=!0,z=!1,J=!1,j=(L)=>{if(!Object.is(L,$))$=L,F=!1,B=void 0,z=!1},V=()=>{z=G===$,$=G,B=void 0},H=(L)=>{let K=W(L);z=i(K,B),$=G,B=K},N=()=>{if(F=!0,!z)I(y)},Q=()=>R(()=>{if(J)throw new X("computed");z=!0,J=!0;let L;try{L=x()}catch(K){H(W(K)),J=!1;return}if(g(L))V(),L.then((K)=>{j(K),I(y)}).catch(H);else if(L==null||G===L)V();else j(L);J=!1},N),O={[Symbol.toStringTag]:f,get:()=>{if(M(y),U(),F)Q();if(B)throw B;return $},map:(L)=>A(()=>L(O.get())),tap:(L)=>{let K={...L,signals:[O]};return C(K),O}};return O},b=(x)=>Y(x,f);var m="State",S=(x)=>{let y=[],$=x,B={[Symbol.toStringTag]:m,get:()=>{return M(y),$},set:(F)=>{if(Object.is($,F))return;if($=F,I(y),G===$)y.length=0},update:(F)=>{B.set(F($))},map:(F)=>A(()=>F(B.get())),tap:(F)=>{let z={...F,signals:[B]};return C(z),B}};return B},w=(x)=>Y(x,m);var G=Symbol(),p=(x)=>w(x)||b(x),v=(x)=>D(x)&&!x.length,c=(x)=>p(x)?x:D(x)?A(x):S(x);export{R as watch,c as toSignal,S as state,w as isState,p as isSignal,v as isComputedCallback,b as isComputed,s as enqueue,C as effect,A as computed,h as batch,G as UNSET,X as CircularDependencyError};
