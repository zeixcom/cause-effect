var N=(y)=>typeof y==="function";var O=(y,x)=>Object.prototype.toString.call(y)===`[object ${x}]`,w=(y)=>(x)=>x instanceof y,p=w(Error),_=w(Promise),Q=(y)=>p(y)?y:new Error(String(y));var X,Y=new Set,D=0,k=new Map,q,g=()=>{q=void 0;let y=Array.from(k.values());k.clear();for(let x of y)x()},o=()=>{if(q)cancelAnimationFrame(q);q=requestAnimationFrame(g)};queueMicrotask(g);var P=(y)=>{if(X&&!y.includes(X))y.push(X)},V=(y)=>{for(let x of y)if(D)Y.add(x);else x()},T=()=>{while(Y.size){let y=Array.from(Y);Y.clear();for(let x of y)x()}},d=(y)=>{D++;try{y()}finally{T(),D--}},I=(y,x)=>{let B=X;X=x;try{y()}finally{X=B}},h=(y,x)=>new Promise((B,F)=>{let L=()=>{try{B(y())}catch(z){F(z)}};if(x)k.set(x,L);o()});var s=(y)=>{let{signals:x,ok:B,err:F}=y,L=y.nil||(()=>{}),z=[],K=[],A=!1;for(let J=0;J<x.length;J++){let M=x[J];try{let W=M.get();if(W===G)A=!0;z[J]=W}catch(W){K.push(Q(W))}}let j=void 0;try{j=A?L():K.length?F(...K):B(...z)}catch(J){F(Q(J))}return j};function R(y){let x=!1,B=()=>I(()=>{if(x)throw new Error("Circular dependency in effect detected");x=!0,s(y),x=!1},B);B()}var E="Computed",n=(y,x)=>{if(!x)return!1;return y.name===x.name&&y.message===x.message},Z=(y)=>{let x=[],B=G,F,L=!0,z=!1,K=!1,A=($)=>{if(!Object.is($,B))B=$,L=!1,F=void 0,z=!1},j=()=>{z=G===B,B=G,F=void 0},J=($)=>{let H=Q($);z=n(H,F),B=G,F=H},M=()=>{if(L=!0,!z)V(x)},W=()=>I(()=>{if(K)throw new Error("Circular dependency in computed detected");z=!0,K=!0;let $;try{$=y()}catch(H){J(Q(H)),K=!1;return}if(_($))j(),$.then((H)=>{A(H),V(x)}).catch(J);else if($==null||G===$)j();else A($);K=!1},M),C={[Symbol.toStringTag]:E,get:()=>{if(P(x),T(),L)W();if(F)throw F;return B},map:($)=>Z(()=>{try{return $(C.get())}catch(H){throw Q(H)}}),tap:($)=>{let H={...$,signals:[C]};return R(H),C}};return C},U=(y)=>O(y,E);var f="State",b=(y)=>{let x=[],B=y,F={[Symbol.toStringTag]:f,get:()=>{return P(x),B},set:(L)=>{if(Object.is(B,L))return;if(B=L,V(x),G===B)x.length=0},update:(L)=>{F.set(L(B))},map:(L)=>Z(()=>L(F.get())),tap:(L)=>{let z={...L,signals:[F]};return R(z),F}};return F},S=(y)=>O(y,f);var G=Symbol(),m=(y)=>S(y)||U(y),i=(y)=>N(y)&&!y.length,v=(y)=>m(y)?y:N(y)?Z(y):b(y);export{I as watch,v as toSignal,b as state,S as isState,m as isSignal,i as isComputedCallback,U as isComputed,h as enqueue,R as effect,Z as computed,d as batch,G as UNSET};
