var D=(y)=>typeof y==="function";var m=(y)=>D(y)&&y.length<2,I=(y,x)=>Object.prototype.toString.call(y)===`[object ${x}]`,o=(y)=>(x)=>x instanceof y,p=o(Error),g=o(Promise),j=(y)=>p(y)?y:new Error(String(y)),w=(y,x)=>{if(!x)return!1;return y.name===x.name&&y.message===x.message};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=(y)=>setTimeout(y,16);var W,T=new Set,P=0,q=new Map,R,f=()=>{R=void 0;for(let y of q.values()){for(let x of y.values())x();y.clear()}},n=()=>{if(R)cancelAnimationFrame(R);R=requestAnimationFrame(f)};queueMicrotask(f);var Y=(y)=>{if(W&&!y.includes(W))y.push(W)},A=(y)=>{for(let x of y)P?T.add(x):x()},S=()=>{while(T.size){let y=Array.from(T);T.clear();for(let x of y)x()}},i=(y)=>{P++,y(),S(),P--},C=(y,x)=>{let L=W;W=x,y(),W=L},h=(y,x)=>new Promise((L,$)=>{let B=()=>{try{L(y())}catch(z){$(z)}};if(x){let[z,J]=x;if(!q.has(z))q.set(z,new Map);q.get(z).set(J,B)}n()}),d=async()=>new Promise(requestAnimationFrame);function N(y,...x){let{ok:L,nil:$,err:B}=D(y)?{ok:y}:y,z=()=>C(()=>{let J=[],K=[],Z=!1;for(let Q of x)try{let G=Q.get();if(G===V)Z=!0;J.push(G)}catch(G){K.push(j(G))}try{if(!Z&&!K.length)L(...J);else if(K.length&&B)B(...K);else if(Z&&$)$()}catch(Q){B?.(j(Q))}},z);z()}var k="Computed",X=(y)=>{let x=[],L=V,$,B=!0,z=!1,J=!1,K=()=>{if(B=!0,!z)A(x)},Z=()=>C(()=>{if(J)throw new Error("Circular dependency detected");z=!0;let G=(H)=>{if(!Object.is(H,L))L=H,B=!1,$=void 0,z=!1},U=(H)=>{let F=j(H);z=w(F,$),$=F};J=!0;try{let H=y(L);g(H)?H.then((F)=>{G(F),A(x)}).catch(U):G(H)}catch(H){U(H)}finally{J=!1}},K),Q={[Symbol.toStringTag]:k,get:()=>{if(Y(x),S(),B)Z();if($)throw $;return L},map:(G)=>X(()=>G(Q.get())),match:(G)=>N(G,Q)};return Q},E=(y)=>I(y,k);var _="State",O=(y)=>{let x=[],L=y,$={[Symbol.toStringTag]:_,get:()=>{return Y(x),L},set:(B)=>{if(Object.is(L,B))return;if(L=B,A(x),V===L)x.length=0},update:(B)=>{$.set(B(L))},map:(B)=>{return X(()=>B($.get()))},match:(B)=>N(B,$)};return $},M=(y)=>I(y,_);var V=Symbol(),b=(y)=>M(y)||E(y),s=(y)=>b(y)?y:m(y)?X(y):O(y);export{C as watch,s as toSignal,O as state,M as isState,b as isSignal,E as isComputed,h as enqueue,N as effect,X as computed,i as batch,d as animationFrame,V as UNSET};
